rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Match files in the structure: {accountId}/{customerId}/{fileName}
    match /{accountId}/{customerId}/{fileName} {
      // Allow read access to authenticated users
      allow read: if request.auth != null;
      
      // Allow write (upload) access to authenticated users
      // File size limit: 2MB (enforced in application code, but can add here too)
      allow write: if request.auth != null
        && request.resource.size < 2 * 1024 * 1024
        && request.resource.contentType.matches('image/.*|application/pdf');
      
      // Allow delete access to authenticated users
      allow delete: if request.auth != null;
    }
    
    // Allow read access to all authenticated users for any other paths (for backward compatibility)
    match /{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow delete: if request.auth != null;
    }
  }
}

